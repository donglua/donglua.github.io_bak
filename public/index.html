<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
  
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  

  
  <title>Donglua</title>

  
  
  <link rel="stylesheet" href="http://this.lu/css/hugo-octopress.css">

  
  

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

  
  <link href="http://this.lu/favicon.png" rel="icon">

  
  
  

  <link href="http://this.lu/index.xml" rel="alternate" type="application/rss+xml" title="Donglua" />

  <meta name="description" content="Stop Stopping">
  <meta name="keywords" content="">

  <meta name="author" content="东东鲁">

  
  <meta name="generator" content="Hugo 0.17" />

  
  

</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="http://this.lu/">Donglua</a></h1>
    <h2></h2>
</hgroup></header>


<nav role="navigation">

<ul class="main-navigation">
  
  
    
      <li><a href="http://this.lu/" title="Home">Home</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        <a href="http://this.lu/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


</nav>


<div id="main">
 <div id="content">
  <div class="blog-index">
    
    
    <article>

        
        

<header>
    <p class="meta">Dec 23, 2016
         - 2 minute read 
        

        
    </p>
    <h1 class="entry-title">
        <a href="http://this.lu/post/jmm-volatile/">Java中的重排序和 volatile 关键字</a>
    </h1>
</header>


        
          <p>内存模型基础 1、内存模型描述的是程序中各变量（线程共享变量）的访问规则，以及在实际计算机系统中将变量存储到内存和从内存读取出变量这样的低层细节。 2、Jvm系统中存在一个主内存(Main Memory或Java Heap Memory)，Java中所有变量都储存在主存中，对于所有线程都是共享的。 3、每条线程都有自己的工作内存(Working Memory)，工作内存中保存的是主存中某些变量的拷贝，线程对所有变量的操作都是在工作内存中进行，线程之间无法相互直接访问，变量传递均需要通过主存完成。
Example:
x = 0; 线程A：x = 1; 线程B：y = x;  线程A与线程B的通信过程如下： * 首先，线程A把本地内存A中更新过的共享变量刷新到主内存中去 * 然后，线程B到主内存中去读取线程A之前已更新过的共享变量
从整体来看，这两个步骤实质上是线程A在向线程B发送消息，而且这个通信过程必须要经过主内存。JMM(Java Memory Model)通过控制主内存与每个线程的本地内存之间的交互，来为java程序员提供内存可见性保证。 &gt; 可见性：一个线程对共享变量的修改能够及时的被其他线程看见
重排序 为什么要重排序 现在的CPU一般采用流水线来执行指令。一个指令的执行被分成：取指、译码、访存、执行、写回、等若干个阶段。然后，多条指令可以同时存在于流水线中，同时被执行。
指令流水线并不是串行的，并不会因为一个耗时很长的指令在“执行”阶段呆很长时间，而导致后续的指令都卡在“执行”之前的阶段上。
重排序的目的是为了性能。
Example: 理想情况下： 过程A：cpu0—写入1—&gt; bank0； 过程B：cpu0—写入2—&gt; bank1； 如果bank0状态为busy, 则A过程需要等待 如果进行重排序，则直接可以先执行B过程。
数据依赖性 如果两个操作访问同一个变量，且这两个操作中有一个为写操作，此时这两个操作之间就存在数据依赖性。
分为下面三种情况： | 名称 | 示例 | 说明 | | &mdash;&mdash;&mdash;&mdash;- |&mdash;&mdash;&mdash;&mdash;- | &mdash;&ndash; | | 写后读 | a = 1; b = a; |写一个变量后再读这个位置 | |写后写|a = 1; a = 2;|写一个变量后再写这个变量| |读后写|a = b; b = 1;|读一个变量后再写这个变量|</p>

          
              <footer>
                  <a href="http://this.lu/post/jmm-volatile/" rel="full-article">阅读全文 &rarr;</a>
              </footer>
          

        

    </article>
    
    <article>

        
        

<header>
    <p class="meta">Nov 16, 2016
         - 2 minute read 
        

        
    </p>
    <h1 class="entry-title">
        <a href="http://this.lu/post/structure-of-dex-file/">Dex 文件结构</a>
    </h1>
</header>


        
          <p><p></p></p>

          
              <footer>
                  <a href="http://this.lu/post/structure-of-dex-file/" rel="full-article">阅读全文 &rarr;</a>
              </footer>
          

        

    </article>
    
    
    




  

  </div>

  

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="//www.github.com/donglua" title="//www.github.com/donglua"><i class="fa fa-github fa-3x"></i></a>
      
      
      
       
      
      
      
      
      
      

    
    
    </li>
  </ul>

  

  

  
  
  

</aside>
    
 </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2016 东东鲁 - <a href="http://this.lu/license/">License</a> -
  <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
</p>

</footer>


</body>
</html>
   
